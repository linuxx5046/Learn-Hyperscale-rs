graph TD
    START["ðŸš€ Bloco Proposto  
Block(Epoch, Round, TXs)"] --> RECEIVE["ðŸ“¥ NÃ³ Recebe Proposta"]
    
    RECEIVE --> VALIDATE["âœ… Valida Bloco  
- Assinatura do LÃ­der  
- Merkle Root  
- State Root  
- Parent QC"]
    
    VALIDATE -->|InvÃ¡lido| REJECT["âŒ Rejeita  
NÃ£o vota"]
    
    VALIDATE -->|VÃ¡lido| LOCK_CHECK{"Block Locked?  
Vote Locking Rule"}
    
    LOCK_CHECK -->|Sim| LOCKED["ðŸ”’ Verifica Lock  
QC.Round > Locked.Round?"]
    LOCKED -->|NÃ£o| REJECT
    LOCKED -->|Sim| CREATE_VOTE
    
    LOCK_CHECK -->|NÃ£o| CREATE_VOTE["ðŸ—³ï¸ Cria Voto  
Vote(BlockHash, Validator, Sig)"]
    
    CREATE_VOTE --> BROADCAST["ðŸ“¢ Broadcast Voto  
Envia para todos"]
    
    BROADCAST --> COLLECT["ðŸ“Š Coleta de Votos  
VoteSet no LÃ­der"]
    
    COLLECT --> ACCUMULATE["ðŸ“ˆ Acumula Votos  
VoteSet.add(Vote)"]
    
    ACCUMULATE --> COUNT{"Votos >= 2f+1?  
QuÃ³rum Atingido?"}
    
    COUNT -->|NÃ£o| WAIT["â³ Aguarda Mais Votos"]
    WAIT --> ACCUMULATE
    
    COUNT -->|Sim| VERIFY["âœ… Verifica Assinaturas  
Batch Verification"]
    
    VERIFY -->|Falha| REJECT
    VERIFY -->|Sucesso| AGGREGATE["ðŸ”— Agrega Assinaturas  
BLS12-381 Aggregation"]
    
    AGGREGATE --> CREATE_QC["ðŸŽ–ï¸ Cria Quorum Certificate  
QC{  
  BlockHash,  
  Height,  
  AggregatedSig,  
  SignerBitfield  
}"]
    
    CREATE_QC --> BROADCAST_QC["ðŸ“¢ Broadcast QC  
Envia para todos"]
    
    BROADCAST_QC --> RECEIVE_QC["ðŸ“¥ NÃ³ Recebe QC"]
    
    RECEIVE_QC --> VALIDATE_QC["âœ… Valida QC  
- Verifica Assinatura Agregada  
- Verifica QuÃ³rum (2f+1)"]
    
    VALIDATE_QC -->|InvÃ¡lido| REJECT_QC["âŒ Rejeita QC"]
    
    VALIDATE_QC -->|VÃ¡lido| UPDATE_STATE["ðŸ”„ Atualiza Estado  
HighQC = QC  
Locked = QC"]
    
    UPDATE_STATE --> COMMIT_CHECK{"Two-Chain Rule?  
QC.Parent.Parent == Commit?"}
    
    COMMIT_CHECK -->|NÃ£o| WAIT_COMMIT["â³ Aguarda PrÃ³ximo QC"]
    COMMIT_CHECK -->|Sim| COMMIT["âœ… Commita Bloco  
Executa TransaÃ§Ãµes  
State Root Final"]
    
    COMMIT --> FINALIZE["âœ”ï¸ Bloco Finalizado  
ImutÃ¡vel"]
    
    REJECT --> END["ðŸ Fim"]
    REJECT_QC --> END
    FINALIZE --> END
    
    style START fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style CREATE_VOTE fill:#4c6ef5,stroke:#1971c2,color:#fff
    style CREATE_QC fill:#51cf66,stroke:#2f9e44,color:#fff
    style COMMIT fill:#ffd43b,stroke:#f59f00,color:#000
    style FINALIZE fill:#da77f2,stroke:#9c36b5,color:#fff