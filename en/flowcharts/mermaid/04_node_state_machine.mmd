graph TB
    subgraph "Event Input"
        EVENT_NETWORK["ğŸŒ Network Event<br/>Proposal, Vote, QC"]
        EVENT_TIMER["â±ï¸ Timer Event<br/>Round Timeout"]
        EVENT_TX["ğŸ“ TX Event<br/>New Transaction"]
    end
    
    subgraph "NodeStateMachine"
        DISPATCH["ğŸ¯ Event Dispatcher<br/>Routes to components"]
        
        subgraph "Internal Components"
            BFT_STATE["âš™ï¸ BFT State<br/>Epoch, Round, View"]
            EXEC_STATE["âš¡ Execution State<br/>Account State"]
            MEMPOOL_STATE["ğŸ“¦ Mempool State<br/>Pending Transactions"]
            PROV_STATE["ğŸ”„ Provisioning State<br/>Assembling Blocks"]
            LIVELOCK_STATE["ğŸ” Livelock State<br/>Cycle Detection"]
        end
        
        PROCESS["ğŸ”„ Process Event<br/>Handle(Event) â†’ Actions"]
    end
    
    subgraph "Generated Actions"
        ACTION_VOTE["ğŸ—³ï¸ Action: Vote<br/>Send vote to network"]
        ACTION_PROPOSE["ğŸ“ Action: Propose<br/>Leader proposes block"]
        ACTION_EXEC["âš¡ Action: Execute<br/>Execute transactions"]
        ACTION_BROADCAST["ğŸ“¢ Action: Broadcast<br/>Send P2P message"]
    end
    
    subgraph "Output"
        OUTPUT["ğŸ“¤ Event Output<br/>Update local state"]
    end
    
    EVENT_NETWORK --> DISPATCH
    EVENT_TIMER --> DISPATCH
    EVENT_TX --> DISPATCH
    
    DISPATCH --> BFT_STATE
    DISPATCH --> EXEC_STATE
    DISPATCH --> MEMPOOL_STATE
    DISPATCH --> PROV_STATE
    DISPATCH --> LIVELOCK_STATE
    
    BFT_STATE --> PROCESS
    EXEC_STATE --> PROCESS
    MEMPOOL_STATE --> PROCESS
    PROV_STATE --> PROCESS
    LIVELOCK_STATE --> PROCESS
    
    PROCESS --> ACTION_VOTE
    PROCESS --> ACTION_PROPOSE
    PROCESS --> ACTION_EXEC
    PROCESS --> ACTION_BROADCAST
    
    ACTION_VOTE --> OUTPUT
    ACTION_PROPOSE --> OUTPUT
    ACTION_EXEC --> OUTPUT
    ACTION_BROADCAST --> OUTPUT
    
    OUTPUT -->|Feedback| DISPATCH
    
    style DISPATCH fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style PROCESS fill:#4c6ef5,stroke:#1971c2,color:#fff
    style ACTION_VOTE fill:#51cf66,stroke:#2f9e44,color:#fff
    style ACTION_EXEC fill:#ffd43b,stroke:#f59f00,color:#000
